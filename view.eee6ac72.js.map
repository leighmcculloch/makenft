{"mappings":"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","sources":["src/view.js"],"sourcesContent":["import StellarSdk from 'stellar-sdk';\nimport * as ipfsCore from 'ipfs-core';\nimport * as config from './config.js';\n\nwindow.init = wrapErrorHandling(init);\n\nasync function init() {\n    const url = window.location.href;\n    const hashIndex = url.indexOf(\"#\");\n    if (hashIndex === -1) {\n        throw new Error(\"NFT not specified in web address.\")\n    }\n    const hash = url.substring(hashIndex + 1);\n\n    const hashParts = hash.split(\":\", 2);\n    let network = undefined;\n    let asset = undefined;\n    if (hashParts.length == 1) {\n        network = \"pubnet\";\n        asset = hashParts[0];\n    } else if (hashParts.length == 2) {\n        network = hashParts[0];\n        asset = hashParts[1];\n    } else {\n        throw new Error(\"NFT web address malformed.\")\n    }\n\n    const assetParts = asset.split(\"-\", 2);\n    if (assetParts.length !== 2) {\n        throw new Error(\"NFT web address malformed.\")\n    }\n    const code = assetParts[0];\n    const issuer = assetParts[1];\n\n    const cfg = config.getConfig(network);\n\n    const account = await cfg.horizonServer.loadAccount(issuer);\n\n    let nftMetaUrl = (() => {\n        const value = account.data_attr[`nft.meta.url`];\n        if (typeof value === \"undefined\") {\n            return \"\";\n        }\n        return atob(value);\n    })();\n    for (let i = 0; ; i++) {\n        const value = account.data_attr[`nft.meta.url[${i}]`];\n        if (typeof value === \"undefined\") {\n            break;\n        }\n        nftMetaUrl += atob(value);\n    }\n    let nftMetaUrlLink = nftAssetUrl;\n    if (nftMetaUrl.startsWith(\"ipfs://\")) {\n        nftMetaUrlLink = cfg.ipfsUrl(nftMetaUrl.substring(7));\n    }\n    const nftMetaHash = (() => {\n        const sha256 = account.data_attr[`nft.meta.sha256`];\n        if (sha256) {\n            return atob(sha256);\n        }\n        return null;\n    })();\n    let nftMetaJson = {};\n    if (nftMetaUrl !== \"\" && nftMetaUrl.startsWith(\"ipfs://\")) {\n        const nftMetaCid = nftMetaUrl.substring(7);\n        const ipfsNode = await getIpfsNode();\n        const stream = ipfsNode.cat(nftMetaCid);\n        let nftMetaData = \"\";\n        for await (const chunk of stream) {\n            nftMetaData += chunk.toString()\n        }\n        // TODO: Compare returned value with sha256.\n        nftMetaJson = JSON.parse(nftMetaData);\n    }\n    // TODO: Handle non-IPFS meta URLs.\n\n    let nftAssetUrl = nftMetaJson['url'];\n    let nftAssetUrlLink = nftAssetUrl;\n    if (nftAssetUrl.startsWith(\"ipfs://\")) {\n        nftAssetUrlLink = cfg.ipfsUrl(nftAssetUrl.substring(7));\n    }\n    const nftAssetHash = nftMetaJson['sha256'];\n\n    document.getElementById(\"code\").innerText = code;\n    const preview = document.createElement(\"img\");\n    preview.src = nftAssetUrlLink;\n    const filePreview = document.getElementById(\"file-preview\");\n    while (filePreview.firstChild) {\n        filePreview.removeChild(filePreview.firstChild);\n    }\n    filePreview.appendChild(preview);\n\n    let text =\n        `Asset: <a href=\"${nftAssetUrlLink}\">${nftAssetUrl}</a>`;\n    if (nftAssetHash) {\n        text += `<br/>` +\n            `Hash: ${nftAssetHash}`;\n    }\n    resultData(text);\n\n    let meta = \"\";\n    if (nftMetaUrl !== \"\") {\n        meta += `Meta: <a href=\"${nftMetaUrlLink}\">${nftMetaUrl}</a>`;\n    }\n    if (nftMetaHash) {\n        meta += `<br/>` +\n            `Hash: ${nftMetaHash}`;\n    }\n    if (nftMetaUrl !== \"\" && nftMetaUrl.startsWith(\"ipfs://\")) {\n        const metaJsonHtml = `${JSON.stringify(nftMetaJson, null, \"  \")}`;\n        resultMetaJson(metaJsonHtml);\n    }\n    if (meta !== \"\") {\n        resultMeta(meta);\n    }\n\n    resultSuccess(\n        `View on a <a href=\"${cfg.explorerAssetUrl(code, issuer)}\" target=\"_blank\" rel=\"noopener\">block explorer</a>.</br>` +\n        `See the current owner(s) <a href=\"${cfg.explorerAssetHoldersUrl(code, issuer)}\" target=\"_blank\" rel=\"noopener\">here</a>.</br>` +\n        `Make an offer to buy or sell this NFT using a <a href=\"${cfg.dexAssetUrl(code, issuer)}\" target=\"_blank\" rel=\"noopener\">DEX app</a>.`\n    );\n}\n\nfunction wrapErrorHandling(f) {\n    return async () => {\n        try {\n            await f();\n        } catch (error) {\n            resultError(error.error || error);\n            throw error;\n        }\n    };\n}\n\nfunction resultError(error) {\n    const result = document.getElementById(\"result\");\n    result.innerText = error.toString();\n}\n\nfunction resultSuccess(html) {\n    const result = document.getElementById(\"result\");\n    result.innerHTML = html;\n}\n\nfunction resultData(html) {\n    const result = document.getElementById(\"result-data\");\n    result.innerHTML = html;\n}\n\nfunction resultMeta(html) {\n    const result = document.getElementById(\"result-meta\");\n    result.innerHTML = html;\n}\n\nfunction resultMetaJson(html) {\n    const result = document.getElementById(\"result-meta-json\");\n    result.innerHTML = html;\n}\n\nlet ipfsNode = null;\nasync function getIpfsNode() {\n    if (ipfsNode !== null) {\n        return ipfsNode;\n    }\n    ipfsNode = await ipfsCore.create();\n    return ipfsNode;\n}\n\ninit();\n"],"names":["f","_stellarSdk","require","_ipfsCore","_configJs","init","url","window","location","href","hashIndex","indexOf","Error","hashParts","substring","split","network","asset","length","assetParts","code","issuer","cfg","getConfig","account","horizonServer","loadAccount","nftMetaUrl","value","data_attr","atob","i","nftMetaUrlLink","nftAssetUrl","startsWith","ipfsUrl","nftMetaHash","sha256","nftMetaJson","nftMetaCid","stream","ipfsNode","create","getIpfsNode","cat","nftMetaData","chunk","toString","JSON","parse","nftAssetUrlLink","nftAssetHash","document","getElementById","innerText","preview","createElement","src","filePreview","firstChild","removeChild","appendChild","text","html","innerHTML","meta","resultMetaJson","stringify","resultMeta","resultSuccess","explorerAssetUrl","explorerAssetHoldersUrl","dexAssetUrl","async","error","resultError"],"version":3,"file":"view.eee6ac72.js.map"}